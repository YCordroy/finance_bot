# Бот для учета трат.
___

**Описание**: 

Данный бот позволяет записывать траты в базу данных и получать по ним отчёт в виде таблицы Excel.

Бот был написан, для личного использования, некоторые решения сделаны исходя из этого.<br>
 

Вся работа с базой данных происходит в `sqlite`.

**Модули**:
* `Functions.py` содержит основные функции работы бота.
* `Handlers.py` содержит обработчики взаимодействия с ботом.
* `DataBase.py` модуль для работы с базой данных.
* `Tables.py` модуль для таблиц.
* `Keyboards.py` модуль для создания клавиатур.
* 'Settings.py' модуль с основными настройками.
___

## Принцип работы:
**команды**:
* `/report`- получение отчёта
* `/end` - принудительная остановка добавления записи в бд

### При вводе суммы траты:
Начинается опрос пользователя:
* Выбираем категорию трат
* Вводим комментарий

Если необхдимо прервать запись, воспользуйтесь командой `/end`.

Далее можно изменить дату и категорию, либо удалить запись из базы данных.

*Важно! - для корректного удаления из бд, удалять запись с тратой необходимо через кнопку.

*Для правильного отображения отчёта, при изменении списка категорий,<br>
необходимо поменять категории в словаре в функции `report_transform_report` модуля `DataBase`.

[**Демонстрация работы**](https://youtube.com/shorts/dZxXWJlC5CA?feature=share)

### По команде `/report`: 
Начинается опрос пользователя:
* Выбираем дату начала отчёта
* Выбираем дату окончания отчёта
* Выбираем пользователей

После выбора пользователя происходит отправка Excel файла с отчётом.

[**Демонстрация работы**](https://youtube.com/shorts/mk9Q8d06Egk?feature=share)
___
## Как запустить бота:

В папке `workdir`(создать в директории приложения, если её нет) , cоздать файл `.env`.
В нём нужно записать токен и словарь с пользователями в формате:
```python
TOKEN = 'id вашего бота'
USERS = {456546: 'Василий', 4863112: 'Алёна'}
```
**Добавление пользователей необходимо для допуска к функционалу бота и правильного отчёта из базы данных.**

Создать окружение и активировать его.
Установить необходимые библиотеки.
```
pip install -r requirements.txt
```


## Запуск в Docker:
Создать на сервере папку для хранения базы данных и файла `.env`.
В этой папке создать файл `.env` и записать в него токен и словарь с пользователями.
```python
TOKEN = 'id вашего бота'
USERS = {456546: 'Василий', 4863112: 'Алёна'}
```

В папке с файлами создать image.
```
sudo docker build -t name .
```
После создания image в Docker, при запуске контейнера необходимо связать папку `/usr/src/app/Finance_bot/workdir`
с папкой на сервере, в которой будет хранится `.env` и база данных.
```
sudo docker run -d -v $PWD:/usr/src/app/Finance_bot/workdir --name name image_name
```
Где `$PWD` это путь к директории на сервере.






