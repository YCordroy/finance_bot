# Бот для учета трат.
___

**Описание**: 

Данный бот позволяет записывать траты в базу данных и получать по ним отчёт в виде таблицы Excel.

Бот был написан, для личного использования, некоторые решения сделаны исходя из этого.

Вся работа с базой данных происходит в `sqlite`.

**Модули**:
* `new_func.py` содержит основные функции работы бота.
* `handlers.py` содержит обработчики взаимодействия с ботом.
* `datab.py` модуль для работы с базой данных.
* `Create_table.py` модуль для таблиц.
* `Keyboards.py` модуль для создания клавиатур.
___

## Принцип работы:
**команды**:
* `/add` - запись покупки в базу данных
* `/report`- получение отчёта
* `/end` - принудительная остановка добавления записи в бд

### По команде `/add`:
Начинается опрос пользователя:
* Выбираем категорию трат
* Вводим сумму
* Вводим комментарий

Если необхдимо прервать запись, воспользуйтесь командой `/end`.

Далее можно изменить дату и категорию, либо удалить запись из базы данных.

*Важно! - для корректного удаления из бд, удалять запись с тратой необходимо через кнопку.

[**Демонстрация работы**](https://youtube.com/shorts/dZxXWJlC5CA?feature=share)

### По команде `/report`: 
Начинается опрос пользователя:
* Выбираем дату начала отчёта
* Выбираем дату окончания отчёта
* Выбираем пользователей

После выбора пользователя происходит отправка Excel файла с отчётом.

[**Демонстрация работы**](https://youtube.com/shorts/mk9Q8d06Egk?feature=share)
___
## Как запустить бота:

В папке `workdir`(создать в директории приложения, если её нет) , cоздать файл `.env`.
В нём нужно записать токен и словарь с пользователями в формате:
```python
TOKEN = 'id вашего бота'
USERS = {456546: 'Василий', 4863112: 'Алёна'}
```
**Добавление пользователей необходимо для допуска к функционалу бота и правильного отчёта из базы данных.**

Создать окружение и активировать его.
Установить необходимые библиотеки.
```
pip install -r requirements.txt
```

Для общения с базой данных, например для удаления таблицы, есть функция `execute_no_return(sql)`.
Она находится в `datab.py`, в неё передается sql запрос.

Перед запуском, вызываем её в мейн:
```python
if __name__ == '__main__':
    # Например
    execute_no_return('drop table Название таблицы')
    # Код запуска бота
```

## Запуск в Docker:
Создать на сервере папку для хранения базы данных и файла `.env`.
В этой папке создать файл `.env` и записать в него токен и словарь с пользователями.
```python
TOKEN = 'id вашего бота'
USERS = {456546: 'Василий', 4863112: 'Алёна'}
```

В папке с файлами создать image.
```
sudo docker build -t name .
```
После создания image в Docker, при запуске контейнера необходимо связать папку `/usr/src/app/Finance_bot/workdir`
с папкой на сервере, в которой будет хранится `.env` и база данных.
```
sudo docker run -d -v $PWD:/usr/src/app/Finance_bot/workdir --name name image_name
```
Где `$PWD` это путь к директории на сервере.






