# Бот для учета трат.
___

**Описание**: 

Данный бот позволяет записывать траты в базу данных и получать по ним отчёт в виде таблицы Excel.

Бот был написан, для личного использования, некоторые решения сделаны исходя из этого.

Вся работа с базой данных происходит в `sqlite`.

**Модули**:
* `new_func.py` содержит основные функции работы бота.
* `handlers.py` содержит обработчики взаимодействия с ботом.
* `datab.py` модуль для работы с базой данных.
* `Create_table.py` модуль для таблиц.
* `Keyboards.py` модуль для создания клавиатур.
___

## Принцип работы:
**команды**:
* `/add` - запись покупки в базу данных
* `/report`- получение отчёта
* `/end` - принудительная остановка добавления записи в бд

### По команде `/add`:
Начинается опрос пользователя:
* Выбираем категорию трат
* Вводим суммы
* Вводим комментария

Если необхдимо прервать запись, воспользуйтесь командой `/end`.

Далее можно изменить дату и категорию, либо удалить запись из базы данных.

*Важно! - для корректного удаления из бд, удалять запись с тратой необходимо через кнопку.

[**Демонстрация работы**](https://youtube.com/shorts/M5m4XD2zfSE?feature=share)

### По команде `/report`: 
Начинается опрос пользователя:
* Выбираем дату начала отчёта
* Выбираем дату окончания отчёта
* Выбираем пользователей

После выбора пользователя происходит отправка Excel файла с отчётом.

[**Демонстрация работы**](https://youtube.com/shorts/0pvVRxGRuzo?feature=share)
___
## Как запустить бота:

### Перед началом работы:
Создаём файл `.env`.
В нём записать токен в формате:
```python
TOKEN = 'id вашего бота'
```
Подгрузка из файла произойдёт в `main.py`

### При первом запуске:
Автоматически создаётся пустая база данных `Myfin.db`.

Для создания в ней таблиц, из `Create_table` в `main.py` нужно:
* Раскомментировать строку импорта внутри `main.py`.
* Вызвать `create_wastes()` - для создания общей таблицы с тратами.
* Вызвать `create_category()` - для создания таблицы со списком категорий.
* Вызвать `create_user()` - для создания таблицы со списком пользователей.
```python
if __name__ == '__main__':

    create_wastes()
    create_category()
    create_user()
    
    #Далее следует код запуска бота
```
**После первого запуска, эти строки лучше удалить**

### Дальнейшая работа с ботом:
Для дальнейшей работы, необходимо добавить пользователей в таблицу базы данных.
По данным из этой талицы будет предоставлятся доступ к функционалу бота.
Так же эти данные необходимы для правильного получения отчета из базы данных.

Для того что бы добавить нового пользователя:
* Узнать id пользователя в телеграмме
* Записать их в запрос `add_new_user()` внутри `datab.py`
* Вызвать функцию в `main.py`:
  * Раскомментировать строку импорта внутри `main.py`.
  ```python
    # import datab as db
  ```
  * Вызвать функцию в мейн.
  ```python
    if __name__ == '__main__':

       db.add_new_user()
       # Далее следует код запуска бота
  ```
    **После добавления пользователя, удалите эту строку**

Для общения с базой данных, например для удаления таблицы, есть функция `execute_no_return(sql)`.
Она находится в `datab.py`, в неё передается sql запрос.
Также перед запуском, вызываем её в мейн:
```python
if __name__ == '__main__':
    # Например
    execute_no_return('drop table Название таблицы')
    # Далее следует код запуска бота
```











